<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather & Operations Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg:#0b1220; --panel:#020617; --border:#1e293b;
      --text:#fff; --muted:rgba(255,255,255,.7); --gap:8px;
      --col-1:35%; --col-2:40%; --col-3:25%;
      --header-height:64px; --footer-height:36px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; background:var(--bg);
      color:var(--text); font-family:Arial,sans-serif;
      display:flex; flex-direction:column;
    }

    /* HEADER */
    .header-bar{
      min-height:var(--header-height);
      display:grid; grid-template-columns:1fr 1fr 1fr;
      align-items:flex-start; padding:10px 16px 12px;
      background:#020617f2; border-bottom:1px solid var(--border);
    }
    .header-title{font-size:18px;font-weight:700}
    .header-meta{font-size:12px;color:var(--muted);margin-top:4px}
    .separator{margin:0 6px}

    /* DASHBOARD */
    .dashboard{
      flex:1; display:grid;
      grid-template-columns:var(--col-1) var(--col-2) var(--col-3);
      grid-template-rows:1fr 1fr; gap:var(--gap); padding:var(--gap);
    }
    .column-left{
      grid-column:1; grid-row:1/span 2;
      display:grid; grid-template-rows:repeat(3,1fr); gap:var(--gap);
    }

    /* PANELS */
    .panel{
      background:var(--panel); border:1px solid var(--border);
      border-radius:8px; display:flex; flex-direction:column;
      overflow:hidden; position:relative;
    }
    .panel-header{
      padding:6px 10px; font-size:12px; font-weight:bold;
      color:var(--muted); border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center;
    }
    .panel-body{flex:1}
    .panel-body iframe{width:100%;height:100%;border:none}

    .edit-btn{display:none;cursor:pointer;font-size:11px}
    .panel:hover .edit-btn{display:inline}

    /* EDIT UI */
    .edit-form{padding:10px;font-size:12px}
    .edit-form label{display:block;margin:6px 0 2px;color:var(--muted)}
    .edit-form input, .edit-form select{
      width:100%;padding:6px;border-radius:4px;
      border:1px solid var(--border);background:#020617;color:#fff;
    }
    .edit-actions{display:flex;gap:6px;margin-top:8px}
    .edit-actions button{
      flex:1;padding:6px;border:none;border-radius:4px;
      cursor:pointer;font-size:12px
    }
    .apply{background:#2563eb;color:#fff}
    .reset{background:#7c2d12;color:#fff}
    .cancel{background:#374151;color:#fff}

    /* FOOTER */
    .footer-bar{
      height:var(--footer-height); display:flex; justify-content:center;
      align-items:center; border-top:1px solid var(--border);
      background:#020617f2; font-size:12px;color:var(--muted)
    }
    .footer-bar a{color:var(--muted);text-decoration:none;padding:0 6px}
    .footer-bar span{opacity:.5}
  </style>
</head>

<body>

<header class="header-bar">
  <div>
    <div class="header-title">Weather & Operations Dashboard</div>
    <div class="header-meta">
      <span id="time12"></span><span class="separator">|</span>
      <span id="time24"></span><span class="separator">â€¢</span>
      Refresh in <span id="countdown"></span>s
    </div>
  </div>
</header>

<div class="dashboard">
  <div class="column-left">
    <div class="panel" data-id="left-1"></div>
    <div class="panel" data-id="left-2"></div>
    <div class="panel" data-id="left-3"></div>
  </div>
  <div class="panel" data-id="center-top"></div>
  <div class="panel" data-id="right-top"></div>
  <div class="panel" data-id="center-bottom"></div>
  <div class="panel" data-id="right-bottom"></div>
</div>

<footer class="footer-bar">
  <a href="https://www.fairmontstate.edu" target="_blank">FSU</a><span>|</span>
  <a href="https://www.wv511.org" target="_blank">WV 511</a><span>|</span>
  <a href="https://www.weather.gov/rlx" target="_blank">NWS RLX</a>
</footer>

<script>
/* ===== CLOCK ===== */
const REFRESH=600; let r=REFRESH;
setInterval(()=>{ 
  const n=new Date();
  time12.textContent=n.toLocaleTimeString("en-US");
  time24.textContent=n.toLocaleTimeString("en-GB");
  countdown.textContent=r--; if(r<0)location.reload();
},1000);

/* ===== CONTENT LIBRARY ===== */
const library={
  "":{title:"",src:""},
  "traffic":{title:"Traffic Camera",src:"https://webcam.io/webcams/MpbQgP?embed=true"},
  "radar":{title:"Radar (Ventusky)",src:"https://embed.ventusky.com/?p=38.98;-81.21;7&l=radar"},
  "nws":{title:"NWS RLX",src:"https://www.weather.gov/rlx"},
  "wv511":{title:"WV 511",src:"https://www.wv511.org"},
  "radio":{title:"Emergency Radio",src:"https://www.broadcastify.com/webPlayer/40500"}
};

/* ===== DEFAULT CONFIG ===== */
const defaults={
  "left-1":library.traffic,
  "center-top":library.radar,
  "right-top":library.nws
};

/* ===== LOAD / SAVE ===== */
let config=JSON.parse(localStorage.getItem("dashboardConfig"))||structuredClone(defaults);
function save(){localStorage.setItem("dashboardConfig",JSON.stringify(config))}

/* ===== RENDER ===== */
function render(){
  document.querySelectorAll(".panel").forEach(p=>{
    const id=p.dataset.id, c=config[id]||{};
    p.innerHTML=`
      <div class="panel-header">
        <span>${c.title||""}</span>
        <span class="edit-btn" onclick="edit('${id}')">Edit</span>
      </div>
      <div class="panel-body">
        ${c.src?`<iframe src="${c.src}" loading="lazy"></iframe>`:""}
      </div>`;
  });
}

/* ===== EDIT MODE ===== */
function edit(id){
  const c=config[id]||{};
  document.querySelector(`[data-id="${id}"]`).innerHTML=`
    <div class="panel-header">Edit Panel</div>
    <div class="edit-form">
      <label>Preset</label>
      <select onchange="applyPreset('${id}',this.value)">
        ${Object.keys(library).map(k=>`<option value="${k}">${k||"Custom"}</option>`).join("")}
      </select>
      <label>Title</label>
      <input id="t-${id}" value="${c.title||""}">
      <label>iframe URL</label>
      <input id="s-${id}" value="${c.src||""}">
      <div class="edit-actions">
        <button class="apply" onclick="apply('${id}')">Apply</button>
        <button class="reset" onclick="resetPanel('${id}')">Reset</button>
        <button class="cancel" onclick="render()">Cancel</button>
      </div>
    </div>`;
}

function applyPreset(id,key){
  if(!library[key])return;
  document.getElementById(`t-${id}`).value=library[key].title;
  document.getElementById(`s-${id}`).value=library[key].src;
}

function apply(id){
  config[id]={title:document.getElementById(`t-${id}`).value,
              src:document.getElementById(`s-${id}`).value};
  save(); render();
}

function resetPanel(id){
  if(defaults[id]) config[id]=structuredClone(defaults[id]);
  else delete config[id];
  save(); render();
}

render();
</script>

</body>
</html>
