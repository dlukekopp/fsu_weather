<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weather & Operations Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b1220; --panel:#020617; --border:#1e293b;
  --text:#fff; --muted:rgba(255,255,255,.7);
  --gap:8px; --col1:35%; --col2:40%; --col3:25%;
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh; background:var(--bg);
  color:var(--text); font-family:Arial,sans-serif;
  display:flex; flex-direction:column;
}

/* HEADER */
header{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  padding:10px 16px;
  border-bottom:1px solid var(--border);
  background:#020617f2;
  gap:12px;
}
.header-left h1{margin:0;font-size:18px}
.header-meta{font-size:12px;color:var(--muted)}
.header-right{
  font-size:12px;
  color:var(--muted);
  line-height:1.4;
}

/* DASHBOARD */
.dashboard{
  flex:1; display:grid;
  grid-template-columns:var(--col1) var(--col2) var(--col3);
  grid-template-rows:1fr 1fr;
  gap:var(--gap); padding:var(--gap);
}
.column-left{
  grid-column:1; grid-row:1/span 2;
  display:grid; grid-template-rows:repeat(3,1fr); gap:var(--gap);
}

/* PANELS */
.panel{
  background:var(--panel); border:1px solid var(--border);
  border-radius:8px; display:flex; flex-direction:column;
  overflow:hidden;
}
.panel-header{
  padding:6px 10px; font-size:12px; font-weight:bold;
  color:var(--muted); border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between;
}
.panel-body{flex:1}
.panel-body iframe{width:100%;height:100%;border:none}
.edit-btn{display:none;cursor:pointer;font-size:11px}
.panel:hover .edit-btn{display:inline}

/* EDIT UI */
.edit-form{padding:10px;font-size:12px}
.edit-form label{display:block;margin-top:6px;color:var(--muted)}
.edit-form input, .edit-form select{
  width:100%; padding:6px; margin-top:2px;
  background:#020617; color:#fff;
  border:1px solid var(--border); border-radius:4px;
}
.actions{display:flex;gap:6px;margin-top:10px}
.actions button{
  flex:1; padding:6px; border:none; border-radius:4px;
  cursor:pointer; font-size:12px;
}
.apply{background:#2563eb;color:#fff}
.reset{background:#7c2d12;color:#fff}
.cancel{background:#374151;color:#fff}

/* FOOTER */
footer{
  padding:8px; font-size:12px; text-align:center;
  border-top:1px solid var(--border);
  background:#020617f2; color:var(--muted);
}
footer a{color:var(--muted);text-decoration:none;padding:0 6px}
footer span{opacity:.5}
</style>
</head>

<body>

<header>
  <div class="header-left">
    <h1>Weather & Operations Dashboard</h1>
    <div class="header-meta">
      <span id="time12"></span> | <span id="time24"></span>
    </div>
  </div>

  <div></div>

  <div class="header-right" id="wvdeHeader">
    Loading WVDE closuresâ€¦
  </div>
</header>

<div class="dashboard">
  <div class="column-left">
    <div class="panel" data-id="left-1"></div>
    <div class="panel" data-id="left-2"></div>
    <div class="panel" data-id="left-3"></div>
  </div>
  <div class="panel" data-id="center-top"></div>
  <div class="panel" data-id="right-top"></div>
  <div class="panel" data-id="center-bottom"></div>
  <div class="panel" data-id="right-bottom"></div>
</div>

<footer>
  <a href="https://www.fairmontstate.edu" target="_blank">FSU</a><span>|</span>
  <a href="https://www.wv511.org" target="_blank">WV 511</a><span>|</span>
  <a href="https://www.weather.gov/rlx" target="_blank">NWS RLX</a>
</footer>

<script>
/* ===== CLOCK ===== */
setInterval(()=>{
  const n=new Date();
  time12.textContent=n.toLocaleTimeString("en-US");
  time24.textContent=n.toLocaleTimeString("en-GB");
},1000);

/***********************
 * PANEL SOURCE LIBRARY
 ***********************/
const PANEL_SOURCES = {
  "":{label:"Custom",title:"",src:""},
  "traffic":{label:"Traffic Camera",title:"Traffic Camera",src:"https://webcam.io/webcams/MpbQgP?embed=true"},
  "ventusky":{label:"Ventusky Radar",title:"Radar (Ventusky)",src:"https://embed.ventusky.com/?p=38.98;-81.21;7&l=radar"},
  "nws":{label:"NWS RLX",title:"NWS RLX",src:"https://www.weather.gov/rlx"},
  "wv511":{label:"WV 511",title:"WV 511",src:"https://www.wv511.org"},
  "radio":{label:"Emergency Radio",title:"Emergency Radio",src:"https://www.broadcastify.com/webPlayer/40500"}
};

const DEFAULTS = {
  "left-1": PANEL_SOURCES.traffic,
  "center-top": PANEL_SOURCES.ventusky,
  "right-top": PANEL_SOURCES.nws
};

let config = JSON.parse(localStorage.getItem("dashboardConfig")) || structuredClone(DEFAULTS);

function save(){ localStorage.setItem("dashboardConfig", JSON.stringify(config)); }

function render(){
  document.querySelectorAll(".panel").forEach(p=>{
    const id=p.dataset.id, c=config[id]||{};
    p.innerHTML=`
      <div class="panel-header">
        <span>${c.title||""}</span>
        <span class="edit-btn" onclick="edit('${id}')">Edit</span>
      </div>
      <div class="panel-body">
        ${c.src?`<iframe src="${c.src}" loading="lazy"></iframe>`:""}
      </div>`;
  });
}

function edit(id){
  const c=config[id]||{};
  document.querySelector(`[data-id="${id}"]`).innerHTML=`
    <div class="panel-header">Edit Panel</div>
    <div class="edit-form">
      <label>Source</label>
      <select onchange="selectSource('${id}',this.value)">
        ${Object.entries(PANEL_SOURCES).map(([k,v])=>`<option value="${k}">${v.label}</option>`).join("")}
      </select>
      <label>Panel Title</label>
      <input id="title-${id}" value="${c.title||""}">
      <label>iframe URL</label>
      <input id="src-${id}" value="${c.src||""}">
      <div class="actions">
        <button class="apply" onclick="apply('${id}')">Apply</button>
        <button class="reset" onclick="resetPanel('${id}')">Reset</button>
        <button class="cancel" onclick="render()">Cancel</button>
      </div>
    </div>`;
}

function selectSource(id,key){
  const s=PANEL_SOURCES[key];
  if(!s)return;
  document.getElementById(`title-${id}`).value=s.title;
  document.getElementById(`src-${id}`).value=s.src;
}

function apply(id){
  config[id]={title:document.getElementById(`title-${id}`).value,
              src:document.getElementById(`src-${id}`).value};
  save(); render();
}

function resetPanel(id){
  if(DEFAULTS[id]) config[id]=structuredClone(DEFAULTS[id]);
  else delete config[id];
  save(); render();
}

render();

/***********************
 * WVDE RSS (HEADER)
 ***********************/
fetch("https://wveis.k12.wv.us/closings/rss.php")
  .then(r=>r.text())
  .then(xml=>{
    const doc=new DOMParser().parseFromString(xml,"text/xml");
    const items=[...doc.querySelectorAll("item")];
    const counties=["Marion","Harrison","Monongalia"];
    const matches=items.filter(i=>counties.some(c=>i.querySelector("title").textContent.includes(c)));

    if(matches.length===0){
      wvdeHeader.textContent="No county closures or delays reported.";
      return;
    }

    wvdeHeader.innerHTML=matches.map(i=>{
      return `<div>
        <strong>${i.querySelector("title").textContent}</strong><br>
        ${i.querySelector("description").textContent}
      </div>`;
    }).join("");
  })
  .catch(()=>{
    wvdeHeader.textContent="WVDE data unavailable.";
  });
</script>

</body>
</html>
